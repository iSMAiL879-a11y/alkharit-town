<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="بوابة قرية الخريطة، خدمات طبية، زراعية، ومجتمعية على ضفاف نهر الفرات" />
  <meta name="keywords" content="قرية الخريطة, خدمات, الفرات, زراعة, تعليم" />
  <title>بوابة قرية الخريطة</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_GA_ID"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/23.11.5/i18next.min.js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'YOUR_GA_ID');
  </script>
  <style>
    :root {
      --bg-color: #f5f0e1; /* بيج قديم */
      --text-color: #4a3728; /* بني غامق */
      --header-bg: linear-gradient(90deg, #6b4e31, #4a3728); /* ترابي */
      --card-bg: #fff8e7; /* ورق قديم */
      --accent-color: #8a9a5b; /* أخضر زيتوني */
    }
    [data-theme="dark"] {
      --bg-color: #2f2f2f;
      --text-color: #e6d9b7;
      --header-bg: linear-gradient(90deg, #3c2f2f, #2f2f2f);
      --card-bg: #4a3728;
    }
    body {
      font-family: 'Amiri', serif;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.3s ease, color 0.3s ease;
    }
    header {
      background: var(--header-bg);
      color: #e6d9b7;
      padding: 30px 20px;
      text-align: center;
      position: relative;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      border-bottom: 3px solid var(--accent-color);
    }
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAG0lEQVR4nGNgYGBgYGD4//8/AzMzM4M5AwAAAP8AnP/7J1QAAAAASUVORK5CYII=') repeat; /* نسيج ورق قديم */
      opacity: 0.1;
      z-index: 0;
    }
    header h1, header p {
      position: relative;
      z-index: 1;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
    }
    .theme-toggle, .lang-toggle {
      top: 15px;
      background: var(--accent-color);
      padding: 8px;
      border-radius: 5px;
      z-index: 2;
    }
    .theme-toggle { left: 20px; }
    .lang-toggle { left: 60px; }
    .nav-link {
      color: var(--text-color) !important;
      font-size: 1.2rem;
      padding: 8px 15px;
    }
    .nav-link:hover {
      color: var(--accent-color) !important;
    }
    .ticker {
      background: var(--card-bg);
      padding: 10px;
      border: 1px solid var(--accent-color);
      border-radius: 5px;
      font-size: 1rem;
    }
    .ticker-warning {
      background: linear-gradient(90deg, #8a9a5b, #6b4e31);
      color: #fff8e7;
      padding: 15px;
      border-radius: 5px;
    }
    .service-folder {
      background: var(--card-bg);
      border: 2px solid var(--accent-color);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }
    .service-folder:hover {
      transform: translateY(-10px);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
    }
    .ai-chat-button {
      background: var(--accent-color);
      padding: 12px;
      border-radius: 5px;
    }
    .ai-chat-box {
      background: var(--card-bg);
      border: 1px solid var(--accent-color);
      border-radius: 8px;
      width: clamp(250px, 85vw, 320px);
    }
    .ai-chat-box input {
      border-color: var(--accent-color);
    }
    .urgent-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #a52a2a;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      z-index: 1000;
      font-size: 1rem;
      transition: transform 0.3s ease;
    }
    .urgent-btn:hover {
      transform: scale(1.1);
    }
    footer {
      background: var(--header-bg);
      color: #e6d9b7;
      padding: 20px;
      border-top: 3px solid var(--accent-color);
    }
    #stories, #priceCalculator {
      background: var(--card-bg);
      padding: 20px;
      border: 1px solid var(--accent-color);
      border-radius: 8px;
      margin: 20px 0;
    }
    #countdown {
      font-size: 1.2rem;
      color: var(--accent-color);
      text-align: center;
      margin-bottom: 10px;
    }
    @media (max-width: 768px) {
      header { padding: 20px 10px; }
      .theme-toggle, .lang-toggle { top: 10px; }
      .urgent-btn { top: 10px; right: 10px; font-size: 0.9rem; }
      .ai-chat-box { width: 250px; }
    }
  </style>
</head>
<body>
  <header>
    <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
    <button class="lang-toggle" id="langToggle"><i class="fas fa-globe"></i></button>
    <h1 data-i18n="header.title">بوابة قرية الخريطة</h1>
    <p data-i18n="header.description">قرية زراعية نابضة بالحياة على ضفاف نهر الفرات</p>
  </header>

  <button class="urgent-btn" data-bs-toggle="modal" data-bs-target="#urgentModal" data-i18n="urgent.button">طلب عاجل</button>

  <!-- بقية الـ nav وأقسام البحث والإشعارات كما هي -->

  <section class="container my-5" id="home">
    <!-- القسم كما هو مع إضافة قسم حكايات القرية -->
    <div id="stories">
      <h4 data-i18n="stories.title">حكايات القرية</h4>
      <p id="storyText" data-i18n="stories.text">في يوم من الأيام، تجمع أهل القرية حول النهر للاحتفال بموسم الحصاد...</p>
      <button class="btn btn-sm btn-primary" onclick="randomStory()" data-i18n="stories.read_more">اقرأ حكاية أخرى</button>
    </div>
  </section>

  <section class="container my-5" id="priceCalculator">
    <h4 data-i18n="price.title">محاكي الأسعار الزراعية</h4>
    <select id="cropType" class="form-select mb-2">
      <option value="wheat" data-i18n="price.wheat">قمح</option>
      <option value="barley" data-i18n="price.barley">شعير</option>
      <option value="dates" data-i18n="price.dates">تمر</option>
    </select>
    <input type="number" id="cropQuantity" class="form-control mb-2" placeholder="الكمية (طن)" data-i18n="[placeholder]price.quantity">
    <button class="btn btn-primary" onclick="calculatePrice()" data-i18n="price.calculate">احسب السعر</button>
    <p id="priceResult" data-i18n="price.result"></p>
  </section>

  <section class="container my-5" id="events">
    <h3 class="text-center mb-4" data-i18n="events.title">الفعاليات القادمة</h3>
    <div id="countdown"></div>
    <!-- بقية قسم الفعاليات كما هي -->
  </section>

  <!-- نموذج الطلب العاجل -->
  <div class="modal fade" id="urgentModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content" style="background: var(--card-bg); border: 1px solid var(--accent-color);">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="urgent.title">طلب عاجل</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="urgentForm" action="https://formspree.io/f/your-form-id" method="POST">
            <div class="mb-3">
              <label class="form-label" data-i18n="urgent.name">الاسم</label>
              <input type="text" class="form-control" name="name" required>
            </div>
            <div class="mb-3">
              <label class="form-label" data-i18n="urgent.request">تفاصيل الطلب</label>
              <textarea class="form-control" name="request" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary" data-i18n="urgent.submit">إرسال</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="ai-chat">
    <button class="ai-chat-button" onclick="toggleChat()"><i class="fas fa-headset"></i></button>
    <div class="ai-chat-box" id="aiChatBox">
      <h5 data-i18n="chat.title">مساعد القرية</h5>
      <p class="response" data-i18n="chat.welcome">مرحبًا! اسألني عن القرية أو الخدمات!</p>
      <div id="chatSuggestions">
        <button class="btn btn-sm btn-outline-primary m-1" onclick="sendAIQuery('ما موعد الفعالية القادمة؟')" data-i18n="chat.suggest_event">موعد الفعالية</button>
        <button class="btn btn-sm btn-outline-primary m-1" onclick="sendAIQuery('كيف أحجز موعد؟')" data-i18n="chat.suggest_booking">حجز موعد</button>
      </div>
      <input type="text" id="aiInput" placeholder="اكتب سؤالك..." data-i18n="[placeholder]chat.placeholder">
      <button class="btn btn-sm btn-danger mt-2" onclick="clearChatHistory()" data-i18n="chat.clear">مسح السجل</button>
      <div class="response" id="aiResponse"></div>
    </div>
  </div>

  <footer>
    <p data-i18n="footer.copyright">© 2025 قرية الخريطة</p>
    <p id="quote" data-i18n="footer.quote">"الزراعة هي عماد القرية."</p>
    <div>
      <a href="#"><i class="fab fa-facebook"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let playerScore = 0, computerScore = 0, quizScore = 0;
    let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];

    i18next.init({
      lng: 'ar',
      resources: {
        ar: {
          translation: {
            "header.title": "بوابة قرية الخريطة",
            "header.description": "قرية زراعية نابضة بالحياة على ضفاف نهر الفرات",
            "urgent.button": "طلب عاجل",
            "urgent.title": "طلب عاجل",
            "urgent.name": "الاسم",
            "urgent.request": "تفاصيل الطلب",
            "urgent.submit": "إرسال",
            "stories.title": "حكايات القرية",
            "stories.text": "في يوم من الأيام، تجمع أهل القرية حول النهر...",
            "stories.read_more": "اقرأ حكاية أخرى",
            "price.title": "محاكي الأسعار الزراعية",
            "price.wheat": "قمح",
            "price.barley": "شعير",
            "price.dates": "تمر",
            "price.quantity": "الكمية (طن)",
            "price.calculate": "احسب السعر",
            "price.result": "",
            "chat.suggest_event": "موعد الفعالية",
            "chat.suggest_booking": "حجز موعد",
            "footer.quote": "الزراعة هي عماد القرية.",
            // بقية الترجمات كما هي
          },
          en: {
            translation: {
              "header.title": "Al-Kharita Village Portal",
              "header.description": "A vibrant agricultural village on the Euphrates",
              "urgent.button": "Urgent Request",
              "urgent.title": "Urgent Request",
              "urgent.name": "Name",
              "urgent.request": "Request Details",
              "urgent.submit": "Submit",
              "stories.title": "Village Tales",
              "stories.text": "One day, the villagers gathered by the river...",
              "stories.read_more": "Read Another Tale",
              "price.title": "Agricultural Price Calculator",
              "price.wheat": "Wheat",
              "price.barley": "Barley",
              "price.dates": "Dates",
              "price.quantity": "Quantity (tons)",
              "price.calculate": "Calculate Price",
              "price.result": "",
              "chat.suggest_event": "Event Schedule",
              "chat.suggest_booking": "Book Appointment",
              "footer.quote": "Agriculture is the backbone of the village.",
              // بقية الترجمات كما هي
            }
          }
        }
      }
    }, () => {
      document.querySelectorAll('[data-i18n]').forEach(elem => {
        const key = elem.getAttribute('data-i18n');
        if (key.includes('[placeholder]')) elem.placeholder = i18next.t(key.replace('[placeholder]', ''));
        else if (key.includes('[innerHTML]')) elem.innerHTML = i18next.t(key.replace('[innerHTML]', ''));
        else elem.textContent = i18next.t(key);
      });
    });

    function randomStory() {
      const stories = [
        "في يوم من الأيام، تجمع أهل القرية حول النهر...",
        "يقال إن شجرة الزيتون القديمة في القرية عمرها 300 عام...",
        "كان أبو علي يروي قصص الحصاد كل ليلة..."
      ];
      const random = stories[Math.floor(Math.random() * stories.length)];
      document.getElementById('storyText').textContent = random;
    }

    function calculatePrice() {
      const crop = document.getElementById('cropType').value;
      const quantity = parseFloat(document.getElementById('cropQuantity').value) || 0;
      const prices = { wheat: 300, barley: 250, dates: 500 };
      const total = quantity * prices[crop];
      document.getElementById('priceResult').textContent = total ? `السعر التقديري: ${total} دولار` : 'أدخل كمية صالحة!';
    }

    function startCountdown() {
      const nextEvent = new Date('2025-06-10T00:00:00');
      setInterval(() => {
        const now = new Date();
        const diff = nextEvent - now;
        if (diff <= 0) {
          document.getElementById('countdown').textContent = 'الفعالية بدأت!';
          return;
        }
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        document.getElementById('countdown').textContent = `الفعالية القادمة بعد: ${days} يوم، ${hours} ساعة، ${minutes} دقيقة`;
      }, 1000);
    }

    function randomQuote() {
      const quotes = [
        "الزراعة هي عماد القرية.",
        "نهر الفرات يروي أرضنا وقلوبنا.",
        "بالتعاون تبنى القرى."
      ];
      document.getElementById('quote').textContent = quotes[Math.floor(Math.random() * quotes.length)];
    }

    // تحسين الدردشة
    function sendAIQuery(text) {
      const input = text || document.getElementById('aiInput').value.toLowerCase();
      document.getElementById('aiInput').value = input;
      const responseDiv = document.getElementById('aiResponse');
      let response = 'عذرًا، حاول صياغة السؤال بطريقة أخرى!';
      if (input.includes('موعد') || input.includes('فعالية')) {
        response = 'الفعالية القادمة يوم 10 يونيو 2025!';
      } else if (input.includes('حجز')) {
        response = 'اضغط "احجز الآن" في قسم البلدية.';
      }
      chatHistory.push({ user: input, response });
      localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
      responseDiv.innerHTML = response;
      document.getElementById('aiInput').value = '';
    }

    document.addEventListener('DOMContentLoaded', () => {
      randomStory();
      randomQuote();
      startCountdown();
      // بقية الجافاسكربت كما هي
    });
  </script>
</body>
</html>