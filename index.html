<script src="https://unpkg.com/i18next@21.6.3/i18next.min.js"></script>
<script src="https://unpkg.com/i18next-browser-languagedetector@6.1.2/i18nextBrowserLanguageDetector.min.js"></script>
<script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js"></script>

<script>
  // إعداد الترجمة
  i18next.use(i18nextBrowserLanguageDetector).init({
    resources: {
      ar: {
        translation: {
          welcome: "بوابة الخريطة",
          description: "مرحباً بكم في الموقع الرسمي لقرية الخريطة",
          requestFormTitle: "نموذج تقديم الطلبات",
          fullName: "الاسم الكامل",
          requestDetails: "تفاصيل الطلب",
          submitRequest: "إرسال الطلب"
        }
      },
      en: {
        translation: {
          welcome: "Al-Khureitah Portal",
          description: "Welcome to the official website of Al-Khureitah village",
          requestFormTitle: "Request Form",
          fullName: "Full Name",
          requestDetails: "Request Details",
          submitRequest: "Submit Request"
        }
      }
    },
    fallbackLng: 'ar',
    debug: true
  }, function(err, t) {
    updateTranslations();
  });

  function updateTranslations() {
    document.querySelectorAll('[data-i18n]').forEach(elem => {
      const key = elem.getAttribute('data-i18n');
      if (key.includes('[placeholder]')) {
        elem.placeholder = i18next.t(key.replace('[placeholder]', ''));
      } else {
        elem.innerHTML = i18next.t(key);
      }
    });
  }

  // تبديل اللغة
  document.getElementById('languageToggle').addEventListener('click', function () {
    const newLang = i18next.language === 'ar' ? 'en' : 'ar';
    i18next.changeLanguage(newLang, () => {
      updateTranslations();
    });
  });

  // الوضع الليلي مع حفظ التفضيل
  const themeToggle = document.getElementById('themeToggle');
  themeToggle.addEventListener('click', () => {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
  });

  document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
  });

  // إرسال الطلب إلى Telegram
  const token = 'YOUR_TELEGRAM_BOT_TOKEN';
  const chatId = 'YOUR_TELEGRAM_CHAT_ID';

  document.getElementById('requestForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const fullName = document.getElementById('fullName').value.trim();
    const requestDetails = document.getElementById('requestDetails').value.trim();
    const formStatus = document.getElementById('formStatus');

    if (!fullName || !requestDetails) {
      formStatus.textContent = 'يرجى تعبئة جميع الحقول';
      formStatus.style.color = 'red';
      return;
    }

    const message = `طلب جديد من بوابة الخريطة:\nالاسم: ${fullName}\nالتفاصيل: ${requestDetails}`;

    try {
      formStatus.textContent = 'جاري الإرسال...';
      const response = await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          chat_id: chatId,
          text: message
        })
      });

      const data = await response.json();

      if (data.ok) {
        formStatus.textContent = 'تم إرسال الطلب بنجاح';
        formStatus.style.color = 'green';
        document.getElementById('requestForm').reset();
      } else {
        throw new Error('فشل في الإرسال');
      }
    } catch (error) {
      formStatus.textContent = 'حدث خطأ أثناء الإرسال، حاول مرة أخرى';
      formStatus.style.color = 'red';
    }
  });
</script>